---
- name: dnsmasq configuration (/etc/dnsmasq.conf)
  template: >
    dest=/etc/dnsmasq.conf
    src=dnsmasq.conf.j2
    backup=yes
    validate="dnsmasq --test -C %s"
  notify: restart dnsmasq
  when: ansible_distribution != 'SmartOS'

- name: dnsmasq configuration (/opt/local/etc/dnsmasq.conf)
  template: >
    dest=/opt/local/etc/dnsmasq.conf
    src=dnsmasq.conf.j2
    backup=yes
    validate="dnsmasq --test -C %s"
  notify: restart dnsmasq
  when: ansible_distribution == 'SmartOS'

- name: configure additional hosts
  template:
    src: addn_hosts.conf.j2
    dest: /usr/local/etc/{{ dnsmasq_addn_hosts }}
    backup: yes
  notify: restart dnsmasq
  when: dnsmasq_addn_hosts | default(None) != None
